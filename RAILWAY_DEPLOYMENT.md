# Railway Deployment Guide

This guide will help you deploy your GitHub CRM application to Railway.

## Prerequisites

1. **Railway Account**: Sign up at [railway.app](https://railway.app)
2. **GitHub Repository**: Your code should be pushed to GitHub
3. **GitHub OAuth App**: Create a GitHub OAuth app for authentication

## Step 1: Create GitHub OAuth App

1. Go to GitHub Settings → Developer settings → OAuth Apps
2. Click "New OAuth App"
3. Fill in the details:
   - **Application name**: `GitHub CRM`
   - **Homepage URL**: `https://your-app-name.up.railway.app` (you'll get this after deployment)
   - **Authorization callback URL**: `https://your-app-name.up.railway.app/api/auth/callback/github`
4. Save the **Client ID** and **Client Secret**

## Step 2: Deploy to Railway

### Option A: Deploy from GitHub (Recommended)

1. **Connect Repository**:
   - Go to [railway.app](https://railway.app)
   - Click "Deploy from GitHub repo"
   - Select your repository
   - Railway will auto-detect the Dockerfile

2. **Add PostgreSQL Database**:
   - In your Railway project dashboard
   - Click "New" → "Database" → "Add PostgreSQL"
   - Railway will automatically create a PostgreSQL service

### Option B: Deploy using Railway CLI

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Initialize project
railway init

# Deploy
railway up
```

## Step 3: Configure Environment Variables

In your Railway project dashboard, go to your app service and add these environment variables:

### Required Variables

```bash
# Database (Railway will auto-generate this)
DATABASE_URL=postgresql://username:password@host:port/database

# NextAuth Configuration
NEXTAUTH_URL=https://your-app-name.up.railway.app
NEXTAUTH_SECRET=your-super-secret-key-generate-a-random-32-char-string

# GitHub OAuth (from Step 1)
GITHUB_ID=your_github_oauth_client_id
GITHUB_SECRET=your_github_oauth_client_secret

# GitHub API Token (optional fallback)
GITHUB_TOKEN=ghp_your_personal_access_token
```

### How to Set Variables in Railway:

1. Go to your project dashboard
2. Click on your app service
3. Go to "Variables" tab
4. Add each variable with its value

## Step 4: Generate Secure Secrets

Generate a secure NEXTAUTH_SECRET:

```bash
# Option 1: Using OpenSSL
openssl rand -base64 32

# Option 2: Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Option 3: Online generator
# Visit: https://generate-secret.vercel.app/32
```

## Step 5: Update GitHub OAuth App

After deployment:

1. Get your Railway app URL (e.g., `https://your-app-name.up.railway.app`)
2. Update your GitHub OAuth App:
   - **Homepage URL**: `https://your-app-name.up.railway.app`
   - **Authorization callback URL**: `https://your-app-name.up.railway.app/api/auth/callback/github`

## Step 6: Custom Domain (Optional)

1. In Railway dashboard, go to your app service
2. Click "Settings" → "Domains"
3. Add your custom domain
4. Update DNS records as instructed
5. Update `NEXTAUTH_URL` to your custom domain

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string (auto-generated by Railway) | `postgresql://user:pass@host:5432/db` |
| `NEXTAUTH_URL` | Your app's public URL | `https://your-app.up.railway.app` |
| `NEXTAUTH_SECRET` | Secret for NextAuth.js sessions | `your-32-character-secret` |
| `GITHUB_ID` | GitHub OAuth App Client ID | `Iv1.a1b2c3d4e5f6g7h8` |
| `GITHUB_SECRET` | GitHub OAuth App Client Secret | `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0` |
| `GITHUB_TOKEN` | Personal Access Token (optional) | `ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` |

## Troubleshooting

### Database Connection Issues
- Ensure `DATABASE_URL` is correctly set by Railway
- Check that the PostgreSQL service is running

### Build Failures
- Check build logs in Railway dashboard
- Ensure all dependencies are in `package.json`
- Verify Dockerfile syntax

### Authentication Issues
- Verify GitHub OAuth app settings
- Check `NEXTAUTH_URL` matches your deployed URL
- Ensure `NEXTAUTH_SECRET` is set

### Migration Issues
- Check that Drizzle migrations are generated during build
- Verify database permissions
- Check entrypoint script logs

## Railway Features Used

- **Automatic Builds**: From Dockerfile
- **PostgreSQL Database**: Managed database service
- **Environment Variables**: Secure configuration
- **Custom Domains**: Professional URLs
- **Automatic SSL**: HTTPS by default
- **Monitoring**: Built-in observability

## Cost Estimation

Railway's free tier includes:
- **$5/month credit**
- **512MB RAM**
- **1GB storage**
- **100GB bandwidth**

This should be sufficient for development and small production workloads.

## Support

- **Railway Docs**: [docs.railway.app](https://docs.railway.app)
- **Railway Discord**: [discord.gg/railway](https://discord.gg/railway)
- **Railway Status**: [status.railway.app](https://status.railway.app) 